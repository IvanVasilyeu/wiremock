

<!doctype html>
<html lang="en" class="no-js">
  <head>
    

<meta charset="utf-8">



<!-- begin SEO -->



<!--  -->







<title>Simulating faults in API behavior | WireMock</title>







<meta name="description" content="One of the main reasons it’s beneficial to use web service fakes when testing is to inject faulty behaviour that might be difficult to get the real service to produce on demand.">

<meta property="og:locale" content="en-US">
<meta property="og:site_name" content="WireMock">
<meta property="og:title" content="Simulating Faults">

<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="WireMock" />
<meta name="twitter:description" content="One of the main reasons it’s beneficial to use web service fakes when testing is to inject faulty behaviour that might be difficult to get the real service to produce on demand.">


  <link rel="canonical" href="https://wiremock.org/docs/simulating-faults/">
  <meta property="og:url" content="https://wiremock.org/docs/simulating-faults/">



  <meta property="og:description" content="One of the main reasons it’s beneficial to use web service fakes when testing is to inject faulty behaviour that might be difficult to get the real service to produce on demand.">





  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2022-12-30T19:10:22+00:00">
  
    <link rel="next" href="https://wiremock.org/docs/spring-boot/" title="Using with Spring Boot">
  
  
    <link rel="prev" href="https://wiremock.org/docs/running-without-http-server/" title="Running without the HTTP Server">
  





  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Tom Akehurst",
      "url" : "https://wiremock.org",
      "sameAs" : null
    }
  </script>






<!-- end SEO -->





  <!-- Google Analytics -->
<style>.async-hide { opacity: 0 !important} </style>
<!--<script>(function(a,s,y,n,c,h,i,d,e){s.className+=' '+y;h.start=1*new Date;-->
  <!--h.end=i=function(){s.className=s.className.replace(RegExp(' ?'+y),'')};-->
  <!--(a[n]=a[n]||[]).hide=h;setTimeout(function(){i();h.end=null},c);h.timeout=c;-->
<!--})(window,document.documentElement,'async-hide','dataLayer',4000,-->
  <!--{'GTM-WQTGSSM':true});</script>-->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-36386229-2', 'auto');
  ga('require', 'GTM-WQTGSSM');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->



<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:2905132,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>

<script>
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i+"?ref=bwt";
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "e4hf2fljrd");
</script>


<link href="https://wiremock.org/feed.xml" type="application/atom+xml" rel="alternate" title="WireMock Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<link href="https://fonts.googleapis.com/css?family=Lato|Source+Code+Pro|Cairo" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Open+Sans:wght@300;400;500;600;700;800&family=Roboto:wght@400;500;700&family=Ubuntu:wght@400;500;700&display=swap" rel="stylesheet">

<!-- For all browsers -->
<link rel="stylesheet" href="https://wiremock.org/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<link rel="shortcut icon" type="image/x-icon" href="https://wiremock.org/images/favicon.svg">

    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body>
    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    

<style>
  .navlink {
    position: relative !important;
    color: #7d93bd;
    padding-bottom: 0.9rem;
    cursor: pointer;
    font-family: "Ubuntu";
    font-style: normal;
    font-weight: 400;
    font-size: 14px;
  }

  .divSubNav {
    position: relative;
    cursor: default;
    padding: 10px 15px;
    display: none;
    position: absolute;
    content: "";
    left: 0;
    top: 32px;
    width: fit-content;
    background: #FFFFFF;
    box-shadow: 0px -5px 20px rgba(210, 223, 249, 0.5);
  }

  .divSubNav::before {
    position: absolute;
    content: "";
    left: 15px;
    width: 0; 
    height: 0; 
    border-left: 5px solid transparent;
    border-right: 5px solid transparent;
    border-bottom: 7px solid #fff;
    top: -7px;
  }

  .divSubNav a {
    padding: 0 !important;
    margin: 0 0 5px 0;
    width: fit-content !important;
  }

  .divSubNav a:last-child {
    margin-bottom: 0;
  }

  .divSubNav a::before {
    background: none !important;
    
  }

  .navlink:hover > .divSubNav {
    display: block;
  }

  .navlink::before {
    background: unset !important;
  }
  .navHover::before {
    background: unset !important;
  }
</style>

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <a href="/"><img src="https://wiremock.org/images/wireMockLogo.png" style="width: 160px; height: 20px" /></a>
      <nav id="site-nav" class="greedy-nav">
        <!-- <button><div class="navicon"></div></button> -->
        <ul class="visible-links">
          
          
            

            

            
            
            <li class="masthead__menu-item">
              
                <span class="navlink">
                  Docs

                  
                  <div class="divSubNav">
                    
                      <a href="/docs/">
                        WireMock Open Source
                      </a>
                    
                      <a href="https://docs.wiremock.io/getting-started/?utm_source=wiremock.org&utm_medium=masthead_doc-links&utm_campaign=2022_baseline">
                        WireMock Cloud
                      </a>
                    
                      <a href="/studio/docs/">
                        WireMock Studio
                      </a>
                    
                      <a href="https://www.mocklab.io/docs/getting-started/?utm_source=wiremock.org&utm_medium=masthead_doc-links&utm_campaign=2022_baseline">
                        MockLab
                      </a>
                    
                  </div>
                  
                </span>
              
              
            </li>
            
            

          
            

            

            
            
            <li class="masthead__menu-item">
              
                <a class="base_path navHover" href="https://wiremock.org/support" title="Support">
                  Support
                </a>
              
              
            </li>
            
            

          
            

            

            
            
            <li class="masthead__menu-item">
              
                <span class="navlink">
                  Community

                  
                  <div class="divSubNav">
                    
                      <a href="https://github.com/wiremock/wiremock">
                        GitHub
                      </a>
                    
                      <a href="https://github.com/wiremock/wiremock/blob/master/CONTRIBUTING.md">
                        Contributing
                      </a>
                    
                      <a href="/external-resources">
                        Resources
                      </a>
                    
                  </div>
                  
                </span>
              
              
            </li>
            
            

          

          <li class="masthead__menu-item">
            <a class="navHover" href="https://wiremock.io?utm_source=wiremock.org&utm_medium=masthead&utm_campaign=homepage_2022_baseline" title="WireMock Cloud">
              <img src="/images/wiremock-cloud/wiremock_cloud_logo.png" alt="WireMock Cloud" style="vertical-align: middle;height: 28px"/>
            </a>
          </li>
        </ul>
        
      </nav>
      
      <img id="hamburgerMenuIcon" class="hamburgerMenuIcon" src="https://wiremock.org/images/hamburgerMenuIcon.svg" />
      <div id="overlay-menu" class="overlay-menu"></div>
      <div class="mobile-menu-wrapper">
        <img id="closeMenuIcon" class="closeMenuIcon" src="https://wiremock.org/images/closeMenuIcon.svg" />
        <ul>
          <li><a href="/docs">Open Source docs</a></li>
          <li>
            <a href="https://wiremock.io?utm_source=wiremock.org&utm_medium=masthead&utm_campaign=homepage_2022_baseline" title="WireMock Cloud">
              <img src="/images/wiremock-cloud/wiremock_cloud_logo.png" alt="WireMock Cloud" style="vertical-align: middle;height: 28px"/><br>
              WireMock Cloud docs
            </a>
          </li>
          <li><a href="/studio/docs">Studio docs</a></li>
          
          <li><a href="/support">Support</a></li>
          <li><a href="https://github.com/wiremock/wiremock" target="_blank">GitHub</a></li>
          <li><a href="https://github.com/wiremock/wiremock/blob/master/CONTRIBUTING.md" target="_blank">Contributing</a></li>
          <li><a href="/external-resources">Resources</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>


    

<div id="main" class="custom-doc-wrapper" role="main">

  
    

<div class="sidebar">
  <nav class="nav__list">
    <ul class="doc-categories">
      
      
        <li class="doc-category">
          <span class="doc-category__title">Setup</span>
          <ul class="
          doc-category__sub-nav
          
          ">
            
              
              
              
              
              <li class="doc-category__li">
                <a href="/docs/getting-started/">Getting Started</a>
              </li>
            
              
              
              
              
              <li class="doc-category__li">
                <a href="/docs/download-and-installation/">Download and Installation</a>
              </li>
            
              
              
              
              
              <li class="doc-category__li">
                <a href="/docs/running-standalone/">Running as a Standalone Process</a>
              </li>
            
              
              
              
              
              <li class="doc-category__li">
                <a href="/docs/docker/">Running in Docker</a>
              </li>
            
              
              
              
              
              <li class="doc-category__li">
                <a href="/docs/android/">Running on Android</a>
              </li>
            
              
              
              
              
              <li class="doc-category__li">
                <a href="/docs/spring-boot/">Using with Spring Boot</a>
              </li>
            
          </ul>
        </li>
      
      
        <li class="doc-category">
          <span class="doc-category__title">Configuration</span>
          <ul class="
          doc-category__sub-nav
          
          ">
            
              
              
              
              
              <li class="doc-category__li">
                <a href="/docs/https/">HTTPS</a>
              </li>
            
              
              
              
              
              <li class="doc-category__li">
                <a href="/docs/multi-domain-mocking/">Multi-domain Mocking</a>
              </li>
            
          </ul>
        </li>
      
      
        <li class="doc-category">
          <span class="doc-category__title">Java Usage</span>
          <ul class="
          doc-category__sub-nav
          
          ">
            
              
              
              
              
              <li class="doc-category__li">
                <a href="/docs/junit-jupiter/">JUnit 5+ Jupiter</a>
              </li>
            
              
              
              
              
              <li class="doc-category__li">
                <a href="/docs/junit-extensions/">JUnit 4 and Vintage</a>
              </li>
            
              
              
              
              
              <li class="doc-category__li">
                <a href="/docs/java-usage/">Plain Java</a>
              </li>
            
              
              
              
              
              <li class="doc-category__li">
                <a href="/docs/configuration/">Java configuration</a>
              </li>
            
              
              
              
              
              <li class="doc-category__li">
                <a href="/docs/running-without-http-server/">Running without the HTTP Server</a>
              </li>
            
          </ul>
        </li>
      
      
        <li class="doc-category">
          <span class="doc-category__title">Stubbing & Verifying</span>
          <ul class="
          doc-category__sub-nav
          doc-category__sub-nav--active
          ">
            
              
              
              
              
              <li class="doc-category__li">
                <a href="/docs/stubbing/">Stubbing</a>
              </li>
            
              
              
              
              
              <li class="doc-category__li">
                <a href="/docs/request-matching/">Request Matching</a>
              </li>
            
              
              
              
              
              <li class="doc-category__li">
                <a href="/docs/response-templating/">Response Templating</a>
              </li>
            
              
              
              
              
              <li class="doc-category__li doc-category__li--selected">
                <a href="/docs/simulating-faults/">Simulating Faults</a>
              </li>
            
              
              
              
              
              <li class="doc-category__li">
                <a href="/docs/stateful-behaviour/">Stateful Behaviour</a>
              </li>
            
              
              
              
              
              <li class="doc-category__li">
                <a href="/docs/proxying/">Proxying</a>
              </li>
            
              
              
              
              
              <li class="doc-category__li">
                <a href="/docs/verifying/">Verifying</a>
              </li>
            
          </ul>
        </li>
      
      
        <li class="doc-category">
          <span class="doc-category__title">Record & Playback</span>
          <ul class="
          doc-category__sub-nav
          
          ">
            
              
              
              
              
              <li class="doc-category__li">
                <a href="/docs/record-playback/">Record and Playback</a>
              </li>
            
          </ul>
        </li>
      
      
        <li class="doc-category">
          <span class="doc-category__title">Extensibility</span>
          <ul class="
          doc-category__sub-nav
          
          ">
            
              
              
              
              
              <li class="doc-category__li">
                <a href="/docs/extending-wiremock/">Extending WireMock</a>
              </li>
            
              
              
              
              
              <li class="doc-category__li">
                <a href="/docs/stub-metadata/">Stub Metadata</a>
              </li>
            
              
              
              
              
              <li class="doc-category__li">
                <a href="/docs/webhooks-and-callbacks/">Webhooks and Callbacks</a>
              </li>
            
          </ul>
        </li>
      
      
        <li class="doc-category">
          <span class="doc-category__title">Reference</span>
          <ul class="
          doc-category__sub-nav
          
          ">
            
              
              
              
              
              <li class="doc-category__li">
                <a href="/docs/api/">Admin API </a>
              </li>
            
          </ul>
        </li>
      
    </ul>

  </nav>
</div>

  

  

  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    
    <meta itemprop="description" content="One of the main reasons it’s beneficial to use web service fakes whentesting is to inject faulty behaviour that might be difficult to get thereal service to produce on demand. In addition to being able to sendback any HTTP response code indicating an error, WireMock is able togenerate a few other types of problem.">
    <meta itemprop="datePublished" content="December 30, 2022">
    

    <meta itemprop="headline" content="zzzz">

    <div class="page__inner-wrap">
      <header>
        <h1 class="page__title" itemprop="headline">Simulating Faults
</h1>
      </header>

      <section class="page__content" itemprop="text">
        <p><strong>One of the main reasons it’s beneficial to use web service fakes when
testing is to inject faulty behaviour that might be difficult to get the
real service to produce on demand. In addition to being able to send
back any HTTP response code indicating an error, WireMock is able to
generate a few other types of problem.</strong></p>

<h2 id="per-stub-fixed-delays">Per-stub fixed delays</h2>

<p>A stub response can have a fixed delay attached to it, such that the
response will not be returned until after the specified number of
milliseconds:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">stubFor</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="n">urlEqualTo</span><span class="o">(</span><span class="s">"/delayed"</span><span class="o">)).</span><span class="na">willReturn</span><span class="o">(</span>
        <span class="n">aResponse</span><span class="o">()</span>
                <span class="o">.</span><span class="na">withStatus</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span>
                <span class="o">.</span><span class="na">withFixedDelay</span><span class="o">(</span><span class="mi">2000</span><span class="o">)));</span>
</code></pre></div></div>

<p>Or</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"request"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GET"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/delayed"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"response"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
        </span><span class="nl">"fixedDelayMilliseconds"</span><span class="p">:</span><span class="w"> </span><span class="mi">2000</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="global-fixed-stub-delays">Global fixed stub delays</h2>

<p>A fixed delay can be added to all stubs either by calling
<code class="language-plaintext highlighter-rouge">WireMock.setGlobalFixedDelay()</code> or posting a JSON document of the
following form to <code class="language-plaintext highlighter-rouge">http://&lt;host&gt;:&lt;port&gt;/__admin/settings</code>:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"fixedDelay"</span><span class="p">:</span><span class="w"> </span><span class="mi">500</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="per-stub-random-delays">Per-stub random delays</h2>

<p>In addition to fixed delays, a delay can be sampled from a random
distribution. This allows simulation of more specific downstream
latencies, such as a long tail.</p>

<p>Use <code class="language-plaintext highlighter-rouge">#withRandomDelay</code> on the stub to pass in the desired distribution:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">stubFor</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="n">urlEqualTo</span><span class="o">(</span><span class="s">"/random/delayed"</span><span class="o">)).</span><span class="na">willReturn</span><span class="o">(</span>
        <span class="n">aResponse</span><span class="o">()</span>
                <span class="o">.</span><span class="na">withStatus</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span>
                <span class="o">.</span><span class="na">withLogNormalRandomDelay</span><span class="o">(</span><span class="mi">90</span><span class="o">,</span> <span class="mf">0.1</span><span class="o">)));</span>
</code></pre></div></div>

<p>Or set it on the <code class="language-plaintext highlighter-rouge">delayDistribution</code> field via the JSON api:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"request"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GET"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/random/delayed"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"response"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
        </span><span class="nl">"delayDistribution"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lognormal"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"median"</span><span class="p">:</span><span class="w"> </span><span class="mi">80</span><span class="p">,</span><span class="w">
            </span><span class="nl">"sigma"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.4</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="global-random-stub-delays">Global random stub delays</h2>

<p>You can set a random delay globally with
<code class="language-plaintext highlighter-rouge">WireMock.setGlobalRandomDelay()</code> or the JSON api at
<code class="language-plaintext highlighter-rouge">http://&lt;host&gt;:&lt;port&gt;/__admin/settings</code>:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"delayDistribution"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lognormal"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"median"</span><span class="p">:</span><span class="w"> </span><span class="mi">90</span><span class="p">,</span><span class="w">
        </span><span class="nl">"sigma"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.1</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="available-distributions">Available distributions</h2>

<h3 id="lognormal-delay">Lognormal delay</h3>

<p>A lognormal distribution is a pretty good approximation of long tailed
latencies centered on the 50th percentile. It takes two parameters:</p>

<ul>
  <li>median - The 50th percentile of latencies.</li>
  <li>sigma - Standard deviation. The larger the value, the longer
the tail.</li>
</ul>

<p><a href="https://www.wolframalpha.com/input/?i=lognormaldistribution%28log%2890%29%2C+0.4%29">Try different
values</a>
to find a good approximation.</p>

<p>To use, instantiate a <code class="language-plaintext highlighter-rouge">new LogNormal(median, sigma)</code>, or via JSON:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"delayDistribution"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lognormal"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"median"</span><span class="p">:</span><span class="w"> </span><span class="mi">80</span><span class="p">,</span><span class="w">
        </span><span class="nl">"sigma"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.4</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="uniform-delay">Uniform delay</h3>

<p>A uniform distribution can be used for simulating a stable latency with
a fixed amount of jitter. It takes two parameters:</p>

<ul>
  <li>lower - Lower bound of the range, inclusive.</li>
  <li>upper - Upper bound of the range, inclusive.</li>
</ul>

<p>For instance, to simulate a stable latency of 20ms +/- 5ms, use lower =
15 and upper = 25.</p>

<p>To use, instantiate a <code class="language-plaintext highlighter-rouge">new UniformDistribution(15, 25)</code>, or via JSON:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"delayDistribution"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uniform"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"lower"</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w">
        </span><span class="nl">"upper"</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="chunked-dribble-delay">Chunked Dribble Delay</h2>

<p>In addition to fixed and random delays, you can dribble your response back in chunks.
This is useful for simulating a slow network and testing deterministic timeouts.</p>

<p>Use <code class="language-plaintext highlighter-rouge">#withChunkedDribbleDelay</code> on the stub to pass in the desired chunked response, it takes two parameters:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">numberOfChunks</code> - how many chunks you want your response body divided up into</li>
  <li><code class="language-plaintext highlighter-rouge">totalDuration</code> - the total duration you want the response to take in milliseconds</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">stubFor</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="s">"/chunked/delayed"</span><span class="o">).</span><span class="na">willReturn</span><span class="o">(</span>
        <span class="n">aResponse</span><span class="o">()</span>
                <span class="o">.</span><span class="na">withStatus</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span>
                <span class="o">.</span><span class="na">withBody</span><span class="o">(</span><span class="s">"Hello world!"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">withChunkedDribbleDelay</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">1000</span><span class="o">)));</span>
</code></pre></div></div>

<p>Or set it on the <code class="language-plaintext highlighter-rouge">chunkedDribbleDelay</code> field via the JSON API:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"request"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GET"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/chunked/delayed"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"response"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
        </span><span class="nl">"body"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hello world!"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"chunkedDribbleDelay"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"numberOfChunks"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
            </span><span class="nl">"totalDuration"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>With the above settings the <code class="language-plaintext highlighter-rouge">Hello world!</code> response body will be broken into
five chunks and returned one at a time with a 200ms gap between each.</p>

<h2 id="bad-responses">Bad responses</h2>

<p>It is also possible to create several kinds of corrupted responses:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">stubFor</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="n">urlEqualTo</span><span class="o">(</span><span class="s">"/fault"</span><span class="o">))</span>
        <span class="o">.</span><span class="na">willReturn</span><span class="o">(</span><span class="n">aResponse</span><span class="o">().</span><span class="na">withFault</span><span class="o">(</span><span class="nc">Fault</span><span class="o">.</span><span class="na">MALFORMED_RESPONSE_CHUNK</span><span class="o">)));</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">Fault</code> enum has the following options:</p>

<p><code class="language-plaintext highlighter-rouge">EMPTY_RESPONSE</code>: Return a completely empty response.</p>

<p><code class="language-plaintext highlighter-rouge">MALFORMED_RESPONSE_CHUNK</code>: Send an OK status header, then garbage, then
close the connection.</p>

<p><code class="language-plaintext highlighter-rouge">RANDOM_DATA_THEN_CLOSE</code>: Send garbage then close the connection.</p>

<p><code class="language-plaintext highlighter-rouge">CONNECTION_RESET_BY_PEER</code>: Close the connection, setting <code class="language-plaintext highlighter-rouge">SO_LINGER</code> to 0 and thus preventing the <code class="language-plaintext highlighter-rouge">TIME_WAIT</code> state being entered.
Typically causes a “Connection reset by peer” type error to be thrown by the client. Note: this only seems to work properly on *nix OSs. On Windows it will most likely cause the connection to hang rather
than reset.</p>

<p>In JSON (fault values are the same as the ones listed above):</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"request"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GET"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/fault"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"response"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"fault"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MALFORMED_RESPONSE_CHUNK"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

        
      </section>

      <footer class="page__meta">
        
        




      </footer>

      
    </div>

    
  </article>

  
  
</div>


    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        

<div class="page__footer-copyright">
  <img src="https://wiremock.org/images/shortLogo.png" class="short-logo"/>

  <span class="footer-copyright-description">&copy; 2022</span>

  <ul class="footer-social-links">
      <li>
    <a href="http://github.com/wiremock" target="_blank">
      <img src="https://wiremock.org/images/githubIcon.svg" />
    </a>
  </li>

  </ul>
</div>

<script src="https://wiremock.org/assets/js/mobile-navbar.js"></script>
<script src="https://wiremock.org/assets/js/codeTab.js"></script>

<script src="https://wiremock.org/assets/js/sidebar-docs.js"></script>
<script src="https://wiremock.org/assets/js/tracking-events.js"></script>
<script src="https://wiremock.org/assets/js/faq.js"></script>

      </footer>
    </div>

    <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js" integrity="sha256-xNjb53/rY+WmG+4L6tTl9m6PpqknWZvRt0rO1SRnJzw=" crossorigin="anonymous"></script>
    <!-- <script src="https://wiremock.org/assets/js/main.min.js"></script> -->




  </body>
</html>

