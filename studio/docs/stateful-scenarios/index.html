

<!doctype html>
<html lang="en" class="no-js">
  <head>
    

<meta charset="utf-8">



<!-- begin SEO -->



<!--  -->







<title>Simulating State with Scenarios - WireMock</title>







<meta name="description" content="Return different responses based on a state machine">

<meta property="og:locale" content="en-US">
<meta property="og:site_name" content="WireMock">
<meta property="og:title" content="Simulating State with Scenarios">

<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="WireMock" />
<meta name="twitter:description" content="Return different responses based on a state machine">


  <link rel="canonical" href="https://wiremock.org/studio/docs/stateful-scenarios/">
  <meta property="og:url" content="https://wiremock.org/studio/docs/stateful-scenarios/">



  <meta property="og:description" content="Return different responses based on a state machine">





  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2022-09-16T08:25:58+01:00">
  
    <link rel="next" href="https://wiremock.org/studio/docs/stubbing/" title="Stubbing Basics">
  
  
    <link rel="prev" href="https://wiremock.org/studio/docs/soap-stubbing/" title="Working with SOAP">
  





  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Tom Akehurst",
      "url" : "https://wiremock.org",
      "sameAs" : null
    }
  </script>






<!-- end SEO -->





  <!-- Google Analytics -->
<style>.async-hide { opacity: 0 !important} </style>
<!--<script>(function(a,s,y,n,c,h,i,d,e){s.className+=' '+y;h.start=1*new Date;-->
  <!--h.end=i=function(){s.className=s.className.replace(RegExp(' ?'+y),'')};-->
  <!--(a[n]=a[n]||[]).hide=h;setTimeout(function(){i();h.end=null},c);h.timeout=c;-->
<!--})(window,document.documentElement,'async-hide','dataLayer',4000,-->
  <!--{'GTM-WQTGSSM':true});</script>-->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-36386229-2', 'auto');
  ga('require', 'GTM-WQTGSSM');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->



<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:2905132,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>

<link href="https://wiremock.org/feed.xml" type="application/atom+xml" rel="alternate" title="WireMock Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<link href="https://fonts.googleapis.com/css?family=Lato|Source+Code+Pro|Cairo" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Open+Sans:wght@300;400;500;600;700;800&family=Roboto:wght@400;500;700&family=Ubuntu:wght@400;500;700&display=swap" rel="stylesheet">

<!-- For all browsers -->
<link rel="stylesheet" href="https://wiremock.org/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<link rel="shortcut icon" type="image/x-icon" href="https://wiremock.org/images/favicon.svg">

    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body>
  <div class="signup-modal-overlay"></div>

  <div class="signup-modal">
    <div class="close-modal-icon">
      <img src="https://wiremock.org/images/closeModalIcon.png" width="7" height="7" alt="close icon"/>
    </div>

    
    <div class="signup-modal-form">
      <h2>Schedule a call with the WireMock team</h2>
      <script charset="utf-8" type="text/javascript" src="//js-eu1.hsforms.net/forms/v2.js"></script>
      <script>
        hbspt.forms.create({
          region: "eu1",
          portalId: "25724978",
          formId: "4a4ac91e-ce09-4e84-b7e8-4f90df8d3803"
        });
      </script>
    </div>
  </div>
    
    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    

<style>
  .navlink {
    position: relative !important;
    color: #7d93bd;
    padding-bottom: 0.9rem;
    cursor: pointer;
    font-family: "Ubuntu";
    font-style: normal;
    font-weight: 400;
    font-size: 14px;
  }

  .divSubNav {
    position: relative;
    cursor: default;
    padding: 10px 15px;
    display: none;
    position: absolute;
    content: "";
    left: 0;
    top: 32px;
    width: fit-content;
    background: #FFFFFF;
    box-shadow: 0px -5px 20px rgba(210, 223, 249, 0.5);
  }

  .divSubNav::before {
    position: absolute;
    content: "";
    left: 15px;
    width: 0; 
    height: 0; 
    border-left: 5px solid transparent;
    border-right: 5px solid transparent;
    border-bottom: 7px solid #fff;
    top: -7px;
  }

  .divSubNav a {
    padding: 0 !important;
    margin: 0 0 5px 0;
    width: fit-content !important;
  }

  .divSubNav a:last-child {
    margin-bottom: 0;
  }

  .divSubNav a::before {
    background: none !important;
    
  }

  .navlink:hover > .divSubNav {
    display: block;
  }

  .navlink::before {
    background: unset !important;
  }
  .navHover::before {
    background: unset !important;
  }
</style>

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <a href="/"><img src="https://wiremock.org/images/wireMockLogo.png" style="width: 160px; height: 20px" /></a>
      <nav id="site-nav" class="greedy-nav">
        <!-- <button><div class="navicon"></div></button> -->
        <ul class="visible-links">
          
          
            

            

            
            
            <li class="masthead__menu-item">
              
                <span class="navlink">
                  Docs

                  
                  <div class="divSubNav">
                    
                      <a href="/docs/">
                        WireMock Open Source
                      </a>
                    
                      <a href="/studio/docs/">
                        WireMock Studio
                      </a>
                    
                      <a href="https://www.mocklab.io/docs/getting-started/?utm_source=wiremock.org&utm_medium=masthead_doc-links&utm_campaign=2022_baseline">
                        MockLab
                      </a>
                    
                  </div>
                  
                </span>
              
              
            </li>
            
            

          
            

            

            
            
            <li class="masthead__menu-item">
              
                <a class="base_path navHover" href="https://wiremock.org/support" title="Support">
                  Support
                </a>
              
              
            </li>
            
            

          
            

            

            
            
            <li class="masthead__menu-item">
              
                <span class="navlink">
                  Community

                  
                  <div class="divSubNav">
                    
                      <a href="https://github.com/wiremock/wiremock">
                        GitHub
                      </a>
                    
                      <a href="https://github.com/wiremock/wiremock/blob/master/CONTRIBUTING.md">
                        Contributing
                      </a>
                    
                      <a href="/external-resources">
                        Resources
                      </a>
                    
                  </div>
                  
                </span>
              
              
            </li>
            
            

          

          <li class="masthead__menu-item">
            <a class="navHover" href="https://get.mocklab.io?utm_source=wiremock.org&utm_medium=masthead&utm_campaign=homepage_2022_baseline" title="MockLab">
              <img src="/images/mocklab_logo_transparent.png" alt="MockLab logo" style="vertical-align: top;height: 20px;margin-right: 2px;"/>
              MockLab
            </a>
          </li>
        </ul>
        
      </nav>
      
      <img id="hamburgerMenuIcon" class="hamburgerMenuIcon" src="https://wiremock.org/images/hamburgerMenuIcon.svg" />
      <div id="overlay-menu" class="overlay-menu"></div>
      <div class="mobile-menu-wrapper">
        <img id="closeMenuIcon" class="closeMenuIcon" src="https://wiremock.org/images/closeMenuIcon.svg" />
        <ul>
          <li><a href="/docs">Open Source docs</a></li>
          <li><a href="/studio/docs">Studio docs</a></li>
          <li>
              <a href="https://get.mocklab.io?utm_source=wiremock.org&utm_medium=masthead&utm_campaign=homepage_2022_baseline" title="MockLab">
              <img src="/images/mocklab_logo_transparent.png" alt="MockLab logo" style="vertical-align: top;height: 20px;margin-right: 2px;"/>
              MockLab
            </a>
          </li>
          <li><a href="/support">Support</a></li>
          <li><a href="https://github.com/wiremock/wiremock" target="_blank">GitHub</a></li>
          <li><a href="https://github.com/wiremock/wiremock/blob/master/CONTRIBUTING.md" target="_blank">Contributing</a></li>
          <li><a href="/external-resources">Resources</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>


    

<div id="main" class="custom-doc-wrapper" role="main">

  
    

<div class="sidebar">
  <nav class="nav__list">
    <ul class="doc-categories">
      
        
        <li class="doc-category">
          <span class="doc-category__title">Getting Started</span>
          <ul
           class="
           doc-category__sub-nav
           
           ">
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/getting-started/desktop/">Desktop</a>
              </li>
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/getting-started/docker/">Docker</a>
              </li>
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/getting-started/kubernetes/">Kubernetes</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="doc-category">
          <span class="doc-category__title">Stubbing</span>
          <ul
           class="
           doc-category__sub-nav
           doc-category__sub-nav--active
           ">
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/stubbing/"> Basics</a>
              </li>
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/advanced-stubbing/">Advanced </a>
              </li>
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/delays/">Response Delays</a>
              </li>
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/simulating-faults/">Simulating Faults</a>
              </li>
            
              
              
              

              <li class="doc-category__li doc-category__li--selected">
                <a href="/studio/docs/stateful-scenarios/">Simulating State with Scenarios</a>
              </li>
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/proxying/">Proxying</a>
              </li>
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/soap-stubbing/">Working with SOAP</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="doc-category">
          <span class="doc-category__title">Request Matching</span>
          <ul
           class="
           doc-category__sub-nav
           
           ">
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/request-matching/matcher-types/">Overview of Matcher Types</a>
              </li>
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/request-matching/url/">Matching URLs</a>
              </li>
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/request-matching/json/">Matching JSON requests</a>
              </li>
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/request-matching/xml/">Matching XML bodies</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="doc-category">
          <span class="doc-category__title">Response Templating</span>
          <ul
           class="
           doc-category__sub-nav
           
           ">
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/response-templating/basics/">Basics</a>
              </li>
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/response-templating/conditional-logic-and-iteration/">Conditional Logic and Iteration</a>
              </li>
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/response-templating/string-helpers/">String Helpers</a>
              </li>
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/response-templating/string-encodings/">String Encodings</a>
              </li>
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/response-templating/number-helpers/">Number Helpers</a>
              </li>
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/response-templating/dates-and-times/">Dates and Times</a>
              </li>
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/response-templating/random-values/">Random Values</a>
              </li>
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/response-templating/xml/">Working with XML</a>
              </li>
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/response-templating/json/">Working with JSON</a>
              </li>
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/response-templating/jwt/">JSON Web Tokens (JWT)</a>
              </li>
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/response-templating/misc-helpers/">Miscellaneous Helpers</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="doc-category">
          <span class="doc-category__title">Import & Export</span>
          <ul
           class="
           doc-category__sub-nav
           
           ">
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/import-and-export/">Overview</a>
              </li>
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/import-export/wiremock/">WireMock</a>
              </li>
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/swagger/">Swagger and OpenAPI</a>
              </li>
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/import-export/postman/">Postman</a>
              </li>
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/import-export/api/">Via the API</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="doc-category">
          <span class="doc-category__title">Record & Playback</span>
          <ul
           class="
           doc-category__sub-nav
           
           ">
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/recording-stubs/">Recording Stubs</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="doc-category">
          <span class="doc-category__title">Tutorials</span>
          <ul
           class="
           doc-category__sub-nav
           
           ">
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/mock-rest-api/">How to build a mock REST API</a>
              </li>
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/exploratory-testing-tutorial/">Exploratory Testing a Spring Boot App</a>
              </li>
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/automated-testing-with-java/">Automated Testing with Java</a>
              </li>
            
              
              
              

              <li class="doc-category__li">
                <a href="/studio/docs/default-responses/">Serving a Default Response</a>
              </li>
            
              
              
              

              <li class="doc-category__li">
                <a href=""></a>
              </li>
            
          </ul>
        </li>
      
    </ul>

  </nav>
</div>

  

  

  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    
    <meta itemprop="description" content="Some testing activities require that different responses be served for a sequence of identical requests. For instanceif you are testing a to-do list application such as this one you may wish to startwith no to-do list items, post a new item, then see the item appear in the list.">
    <meta itemprop="datePublished" content="September 16, 2022">
    

    <meta itemprop="headline" content="zzzz">

    <div class="page__inner-wrap">
      <header>
        <h1 class="page__title" itemprop="headline">Simulating State with Scenarios
</h1>
      </header>

      <section class="page__content" itemprop="text">
        <p>Some testing activities require that different responses be served for a sequence of identical requests. For instance
if you are testing a to-do list application <a href="/studio/docs/exploratory-testing-tutorial/">such as this one</a> you may wish to start
with no to-do list items, post a new item, then see the item appear in the list.</p>

<p>Assuming there is a “list to-do items” API call used to fetch the list, this must be called twice during the above test,
returning no items on the first invocation, and the newly added item on the second. Since both of these requests will be
identical (same URL, method, request headers), something additional is required for WireMock to differentiate the first and
second cases.</p>

<p>WireMock’s Scenarios solve this problem by providing finite state machines that can be used as additional stub matching conditions.
They allow more than one definition of an otherwise identical stub with different responses based on the current state of the machine.</p>

<h2 id="example">Example</h2>

<p>To implement the above case, you would declare that the stub returning the empty list is only matched when the scenario state is “Started”,
while the stub returning the list with one item is only matched when the scenario state is “First item added”.</p>

<p>Start by creating the stub for the starting state - matched only when the scenario named “To do list” is in the “Started” state. This is configured in the Request
section of the stub form:</p>

<p><img title="Empty to-do list stub request" src="/images/screenshots/scenarios-empty-list-stub-request.png" /></p>

<p>Since this is the starting state the to do list returned should be empty:</p>

<p><img title="Empty to-do list stub response" src="/images/screenshots/scenarios-empty-list-stub-response.png" /></p>

<p>Then create a stub to handle posting of the first list item. When triggered this stub will move the scenario state to “First item added”:</p>

<p><img title="To-do list POST stub" src="/images/screenshots/scenarios-post-item-stub.png" /></p>

<p>Finally, create a stub to return the list containing one item, which is matched only then the scenario is in the “First item added” state:</p>

<p><img title="Single item to-to list stub" src="/images/screenshots/scenario-single-item-stub-request.png" />
<img title="Single item to-to list stub" src="/images/screenshots/scenario-single-item-stub-response.png" /></p>

<h2 id="testing">Testing</h2>

<p>First, make a <code class="language-plaintext highlighter-rouge">GET</code> request to fetch the list, which should be empty. You should be able to do this any number of times
without the result changing:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl http://localhost:8000/todo-items
{
  "items": []
}
</code></pre></div></div>

<p>Now <code class="language-plaintext highlighter-rouge">POST</code> a new item (it actually doesn’t matter what the request body contains, since we didn’t specify a body matcher in the stub):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl http://localhost:8000/todo-items -X POST
</code></pre></div></div>

<p>This should now have moved the scenario state to “First item added”. Getting the list of items again should now return one item:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl http://localhost:8000/todo-items
{
  "items": [
    {
      "id": "1",
      "description": "Read all about Scenarios"
    }
  ]
}
</code></pre></div></div>

<h2 id="scenario-reset">Scenario reset</h2>

<p>All scenarios can be reset to their
“Started” state by clicking <img src="/images/screenshots/scenario-reset-button.png" title="Scenario reset button" style="border: none; height: 35px;" />.</p>

        
      </section>

      <footer class="page__meta">
        
        




      </footer>

      
    </div>

    
  </article>

  
  
</div>


    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        

<div class="page__footer-copyright">
  <img src="https://wiremock.org/images/shortLogo.png" class="short-logo"/>
  
  <span class="footer-copyright-description">&copy; 2022</span>
  
  <ul class="footer-social-links">
      <li>
    <a href="http://github.com/wiremock" target="_blank">
      <img src="https://wiremock.org/images/githubIcon.svg" />
    </a>
  </li>

  </ul>
</div>

<script src="https://wiremock.org/assets/js/mobile-navbar.js"></script>
<script src="https://wiremock.org/assets/js/codeTab.js"></script>

<script src="https://wiremock.org/assets/js/sidebar-docs.js"></script>
<script src="https://wiremock.org/assets/js/signup-modal.js"></script>
<script src="https://wiremock.org/assets/js/tracking-events.js"></script>

      </footer>
    </div>

    <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js" integrity="sha256-xNjb53/rY+WmG+4L6tTl9m6PpqknWZvRt0rO1SRnJzw=" crossorigin="anonymous"></script>
    <!-- <script src="https://wiremock.org/assets/js/main.min.js"></script> -->




  </body>
</html>

